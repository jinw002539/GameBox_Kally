<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta name="monetag" content="9e9b6e6bd2d0351ee9abd27124ab6535">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mestre das Capitais</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --primary: #3b82f6;
            --accent: #f59e0b;
            --correct: #10b981;
            --wrong: #ef4444;
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        /* Background Animado */
        .bg-animation { position: fixed; width: 100%; height: 100%; z-index: -1; overflow: hidden; top: 0; left: 0; }
        .circle { position: absolute; border-radius: 50%; background: linear-gradient(45deg, var(--primary), #8b5cf6); filter: blur(80px); opacity: 0.4; animation: float 10s infinite alternate; }
        .circle:nth-child(1) { width: 300px; height: 300px; top: -100px; left: -50px; }
        .circle:nth-child(2) { width: 250px; height: 250px; bottom: -50px; right: -50px; background: var(--accent); }
        @keyframes float { from { transform: translate(0, 0); } to { transform: translate(30px, 50px); } }

        /* Telas */
        .screen { display: none; padding: 20px; width: 100%; height: 100vh; flex-direction: column; align-items: center; justify-content: center; text-align: center; position: absolute; top: 0; left: 0; }
        .screen.active { display: flex; }

        /* Cards */
        .main-card { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid var(--border); border-radius: 30px; padding: 30px 20px; width: 90%; max-width: 400px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .game-logo { font-weight: 800; font-size: 2rem; line-height: 1.1; margin-bottom: 20px; }
        .highlight { color: var(--accent); text-shadow: 0 0 20px rgba(245, 158, 11, 0.5); }
        
        .btn-main { background: linear-gradient(to right, #2563eb, #3b82f6); color: white; border: none; width: 100%; padding: 18px; border-radius: 20px; font-size: 1.2rem; font-weight: 800; cursor: pointer; margin-top: 15px; box-shadow: 0 10px 15px rgba(0,0,0,0.2); }
        
        /* Mapa */
        .map-header { display: flex; justify-content: space-around; width: 100%; max-width: 400px; margin-bottom: 15px; position: relative; z-index: 10; }
        .pill { background: var(--glass); padding: 8px 15px; border-radius: 20px; border: 1px solid var(--border); font-weight: bold; backdrop-filter: blur(5px); }
        .levels-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; overflow-y: auto; width: 100%; max-width: 400px; padding: 10px 10px 100px 10px; scrollbar-width: none; }
        .level-node { aspect-ratio: 1/1; background: var(--glass); border: 2px solid var(--border); border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; position: relative; transition: 0.3s; }
        .level-node.open { background: linear-gradient(135deg, #3b82f6, #1d4ed8); border: none; box-shadow: 0 8px 15px rgba(59, 130, 246, 0.4); color: white; }
        .level-node.locked { opacity: 0.4; filter: grayscale(1); }
        .node-stars { position: absolute; bottom: -8px; font-size: 10px; background: #1e293b; padding: 2px 8px; border-radius: 10px; color: var(--accent); white-space: nowrap; }

        /* Jogo */
        .timer-container { width: 100%; max-width: 400px; margin-bottom: 10px; }
        .timer-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        #timer-fill { height: 100%; width: 100%; background: var(--correct); transition: width 1s linear; }
        .question-box h2 { font-size: 2.2rem; margin: 20px 0; color: var(--accent); height: 80px; display: flex; align-items: center; justify-content: center; }
        .options-grid { display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 400px; }
        .btn-opt { background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 15px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; text-align: center; }
        .btn-opt.correct { background: var(--correct) !important; border: none; transform: scale(1.02); }
        .btn-opt.wrong { background: var(--wrong) !important; border: none; animation: shake 0.4s; }

        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }

        .review-box { margin-top: 15px; max-height: 150px; overflow-y: auto; text-align: left; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 15px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="bg-animation"><div class="circle"></div><div class="circle"></div></div>

    <section id="screen-start" class="screen active">
        <div class="main-card">
            <div class="game-logo">üåé MESTRE DAS<br><span class="highlight">CAPITAIS</span></div>
            <div class="pill">‚≠ê Total: <span id="total-stars-display">0</span></div>
            <button class="btn-main" onclick="showMap()">JOGAR AGORA</button>
        </div>
    </section>

    <section id="screen-map" class="screen">
        <div class="map-header">
            <div class="pill" onclick="showStart()" style="cursor:pointer">üè† Sair</div>
            <div class="pill">‚≠ê <span id="map-stars-count">0</span></div>
            <div class="pill">üèÜ FASE 40</div>
        </div>
        <div class="levels-grid" id="levels-container"></div>
    </section>

    <section id="screen-game" class="screen">
        <div class="timer-container">
            <div style="display:flex; justify-content: space-between; margin-bottom: 5px; font-weight: 800;">
                <span id="level-label">N√≠vel 1</span>
                <span id="timer-text" style="color:var(--accent)">30s</span>
            </div>
            <div class="timer-bar"><div id="timer-fill"></div></div>
        </div>
        
        <div class="question-box">
            <h2 id="country-name">Portugal</h2>
        </div>
        <div class="options-grid" id="options-container"></div>
    </section>

    <section id="screen-result" class="screen">
        <div class="main-card">
            <h2 id="res-title">Bom Trabalho!</h2>
            <div id="res-stars" style="font-size: 3.5rem; margin: 10px 0;">‚≠ê‚≠ê‚≠ê</div>
            <p id="res-score">Acertaste 0 de 0</p>
            <div class="review-box" id="res-review"></div>
            <button class="btn-main" onclick="showMap()">CONTINUAR</button>
        </div>
    </section>

    <script>
        // SONS
        const sndOk = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
        const sndNo = new Audio('https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3');

        // BANCO DE DADOS
        const db = [
            {p: "Afeganist√£o", c: "Cabul"}, {p: "Alb√¢nia", c: "Tirana"}, {p: "Alemanha", c: "Berlim"},
            {p: "Andorra", c: "Andorra-a-Velha"}, {p: "Angola", c: "Luanda"}, {p: "Antiga e Barbuda", c: "Saint John's"},
            {p: "Ar√°bia Saudita", c: "Riade"}, {p: "Arg√©lia", c: "Argel"}, {p: "Argentina", c: "Buenos Aires"},
            {p: "Arm√©nia", c: "Erevan"}, {p: "Austr√°lia", c: "Camberra"}, {p: "√Åustria", c: "Viena"},
            {p: "Azerbaij√£o", c: "Bacu"}, {p: "Bahamas", c: "Nassau"}, {p: "Bangladexe", c: "Daca"},
            {p: "Barbados", c: "Bridgetown"}, {p: "Bar√©m", c: "Manama"}, {p: "B√©lgica", c: "Bruxelas"},
            {p: "Belize", c: "Belmop√£"}, {p: "Benim", c: "Porto Novo"}, {p: "Bielorr√∫ssia", c: "Minsque"},
            {p: "Bol√≠via", c: "Sucre"}, {p: "B√≥snia e Herzegovina", c: "Saraievo"}, {p: "Botsuana", c: "Gaborone"},
            {p: "Brasil", c: "Bras√≠lia"}, {p: "Brunei", c: "Bandar Seri Begau√£"}, {p: "Bulg√°ria", c: "S√≥fia"},
            {p: "Burquina Faso", c: "Uagadugu"}, {p: "Burundi", c: "Guitega"}, {p: "But√£o", c: "Timfu"},
            {p: "Cabo Verde", c: "Praia"}, {p: "Camar√µes", c: "Iaund√©"}, {p: "Camboja", c: "Pnom Pene"},
            {p: "Canad√°", c: "Otava"}, {p: "Catar", c: "Doa"}, {p: "Cazaquist√£o", c: "Astana"},
            {p: "Chade", c: "Jamena"}, {p: "Ch√©quia", c: "Praga"}, {p: "Chile", c: "Santiago"},
            {p: "China", c: "Pequim"}, {p: "Chipre", c: "Nic√≥sia"}, {p: "Col√¥mbia", c: "Bogot√°"},
            {p: "Comores", c: "Moroni"}, {p: "Congo-Brazzaville", c: "Brazzaville"}, {p: "Coreia do Norte", c: "Pionguiangue"},
            {p: "Coreia do Sul", c: "Seul"}, {p: "Costa do Marfim", c: "Iamussucro"}, {p: "Costa Rica", c: "San Jos√©"},
            {p: "Cro√°cia", c: "Zagrebe"}, {p: "Cuba", c: "Havana"}, {p: "Dinamarca", c: "Copenhaga"},
            {p: "Dominica", c: "Roseau"}, {p: "Egito", c: "Cairo"}, {p: "Emirados √Årabes Unidos", c: "Abu Dhabi"},
            {p: "Equador", c: "Quito"}, {p: "Eritreia", c: "Asmara"}, {p: "Eslov√°quia", c: "Bratislava"},
            {p: "Eslov√©nia", c: "Liubliana"}, {p: "Espanha", c: "Madrid"}, {p: "Essuat√≠ni", c: "Mbabane"},
            {p: "Estados Unidos", c: "Washington, D.C."}, {p: "Est√≥nia", c: "Talim"}, {p: "Eti√≥pia", c: "Adis Abeba"},
            {p: "Fiji", c: "Suva"}, {p: "Filipinas", c: "Manila"}, {p: "Finl√¢ndia", c: "Hels√≠nquia"},
            {p: "Fran√ßa", c: "Paris"}, {p: "Gab√£o", c: "Libreville"}, {p: "G√¢mbia", c: "Banjul"},
            {p: "Gana", c: "Acra"}, {p: "Ge√≥rgia", c: "Tbilissi"}, {p: "Granada", c: "Saint George's"},
            {p: "Gr√©cia", c: "Atenas"}, {p: "Guatemala", c: "Cidade de Guatemala"}, {p: "Guiana", c: "Georgetown"},
            {p: "Guin√©", c: "Conacri"}, {p: "Guin√© Equatorial", c: "Malabo"}, {p: "Guin√©-Bissau", c: "Bissau"},
            {p: "Haiti", c: "Porto do Pr√≠ncipe"}, {p: "Honduras", c: "Tegucigalpa"}, {p: "Hungria", c: "Budapeste"},
            {p: "I√©men", c: "San√°"}, {p: "Ilhas Marechal", c: "Majuro"}, {p: "Ilhas Salom√£o", c: "Honiara"},
            {p: "√çndia", c: "Nova Deli"}, {p: "Indon√©sia", c: "Jacarta"}, {p: "Ir√£o", c: "Teer√£o"},
            {p: "Iraque", c: "Bagdade"}, {p: "Irlanda", c: "Dublim"}, {p: "Isl√¢ndia", c: "Reiquiavique"},
            {p: "Israel", c: "Jerusal√©m"}, {p: "It√°lia", c: "Roma"}, {p: "Jamaica", c: "Kingston"},
            {p: "Jap√£o", c: "T√≥quio"}, {p: "Jibuti", c: "Jibuti"}, {p: "Jord√¢nia", c: "Am√£"},
            {p: "Laos", c: "Vientiane"}, {p: "Lesoto", c: "Maseru"}, {p: "Let√≥nia", c: "Riga"},
            {p: "L√≠bano", c: "Beirute"}, {p: "Lib√©ria", c: "Monr√≥via"}, {p: "L√≠bia", c: "Tr√≠poli"},
            {p: "Listenstaine", c: "Vaduz"}, {p: "Litu√¢nia", c: "V√≠lnius"}, {p: "Luxemburgo", c: "Luxemburgo"},
            {p: "Maced√≥nia do Norte", c: "Esc√≥pia"}, {p: "Madag√°scar", c: "Antananarivo"}, {p: "Mal√°sia", c: "Cuala Lumpur"},
            {p: "Mal√°ui", c: "Lil√¥ngue"}, {p: "Maldivas", c: "Mal√©"}, {p: "Mali", c: "Bamaco"},
            {p: "Malta", c: "Valeta"}, {p: "Marrocos", c: "Rebate"}, {p: "Maur√≠cia", c: "Porto Lu√≠s"},
            {p: "Maurit√¢nia", c: "Nuaquechote"}, {p: "M√©xico", c: "Cidade do M√©xico"}, {p: "Mianmar", c: "Nepid√≥"},
            {p: "Micron√©sia", c: "Paliquir"}, {p: "Mo√ßambique", c: "Maputo"}, {p: "Mold√°via", c: "Quixinau"},
            {p: "M√≥naco", c: "M√≥naco"}, {p: "Mong√≥lia", c: "Ul√£ Bator"}, {p: "Montenegro", c: "Podgoritsa"},
            {p: "Nam√≠bia", c: "Vinduque"}, {p: "Nauru", c: "Iarem"}, {p: "Nepal", c: "Catmandu"},
            {p: "Nicar√°gua", c: "Man√°gua"}, {p: "N√≠ger", c: "Niamei"}, {p: "Nig√©ria", c: "Abuja"},
            {p: "Noruega", c: "Oslo"}, {p: "Nova Zel√¢ndia", c: "Wellington"}, {p: "Om√£", c: "Mascate"},
            {p: "Pa√≠ses Baixos", c: "Amesterd√£o"}, {p: "Palau", c: "Ngerulmud"}, {p: "Panam√°", c: "Cidade do Panam√°"},
            {p: "Papua Nova Guin√©", c: "Porto Moresby"}, {p: "Paquist√£o", c: "Islamabade"}, {p: "Paraguai", c: "Assun√ß√£o"},
            {p: "Peru", c: "Lima"}, {p: "Pol√≥nia", c: "Vars√≥via"}, {p: "Portugal", c: "Lisboa"},
            {p: "Qu√©nia", c: "Nairobi"}, {p: "Quirguist√£o", c: "Bisqueque"}, {p: "Quirib√°ti", c: "Taraua do Sul"},
            {p: "Reino Unido", c: "Londres"}, {p: "Rep√∫blica Centro-Africana", c: "Bangui"}, {p: "Rep√∫blica Democr√°tica do Congo", c: "Quinxassa"},
            {p: "Rep√∫blica Dominicana", c: "Santo Domingo"}, {p: "Rom√©nia", c: "Bucareste"}, {p: "Ruanda", c: "Quigali"},
            {p: "R√∫ssia", c: "Moscovo"}, {p: "Samoa", c: "Apia"}, {p: "Santa L√∫cia", c: "Castries"},
            {p: "S√£o Crist√≥v√£o e Neves", c: "Basseterre"}, {p: "S√£o Marinho", c: "S√£o Marinho"}, {p: "S√£o Tom√© e Pr√≠ncipe", c: "S√£o Tom√©"},
            {p: "S√£o Vicente e Granadinas", c: "Kingstown"}, {p: "Seicheles", c: "Vit√≥ria"}, {p: "Senegal", c: "Dacar"},
            {p: "Serra Leoa", c: "Freetown"}, {p: "S√©rvia", c: "Belgrado"}, {p: "Singapura", c: "Singapura"},
            {p: "S√≠ria", c: "Damasco"}, {p: "Som√°lia", c: "Mogad√≠scio"}, {p: "Sri Lanca", c: "Sri Jaiavardenapura-Cota"},
            {p: "Sud√£o", c: "Cartum"}, {p: "Sud√£o do Sul", c: "Juba"}, {p: "Su√©cia", c: "Estocolmo"},
            {p: "Su√≠√ßa", c: "Berna"}, {p: "Suriname", c: "Paramaribo"}, {p: "Tail√¢ndia", c: "Banguecoque"},
            {p: "Tajiquist√£o", c: "Duchamb√©"}, {p: "Tanz√¢nia", c: "Dodoma"}, {p: "Timor-Leste", c: "D√≠li"},
            {p: "Togo", c: "Lom√©"}, {p: "Tonga", c: "Nacuolofa"}, {p: "Trindade e Tobago", c: "Porto de Espanha"},
            {p: "Tun√≠sia", c: "Tunes"}, {p: "Turquemenist√£o", c: "Asgabate"}, {p: "Turquia", c: "Ancara"},
            {p: "Tuvalu", c: "Funafuti"}, {p: "Ucr√¢nia", c: "Quieve"}, {p: "Uganda", c: "Campala"},
            {p: "Uruguai", c: "Montevideu"}, {p: "Usbequist√£o", c: "Tasquente"}, {p: "Vanuatu", c: "Porto Vila"},
            {p: "Venezuela", c: "Caracas"}, {p: "Vietname", c: "Han√≥i"}, {p: "Z√¢mbia", c: "Lusaca"},
            {p: "Zimb√°bue", c: "Harare"}
        ];

        let state = { totalStars: 0, levels: {}, current: 1, qArray: [], qIdx: 0, score: 0, log: [] };
        let timer, timeLeft = 30;

        if(localStorage.getItem('cap_game_pro')) {
            state = JSON.parse(localStorage.getItem('cap_game_pro'));
        }
        function save() { localStorage.setItem('cap_game_pro', JSON.stringify(state)); }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function showStart() {
            document.getElementById('total-stars-display').innerText = state.totalStars;
            showScreen('screen-start');
        }

        function showMap() {
            const container = document.getElementById('levels-container');
            container.innerHTML = '';
            document.getElementById('map-stars-count').innerText = state.totalStars;
            
            for(let i = 1; i <= 40; i++) {
                const req = (i > 3) ? Math.floor((i - 1) * 2.2) : 0;
                const locked = state.totalStars < req;
                const stars = state.levels[i] || 0;
                
                const div = document.createElement('div');
                div.className = `level-node ${locked ? 'locked' : 'open'}`;
                div.innerHTML = `<span>${i}</span><div class="node-stars">${locked ? 'üîí '+req : '‚≠ê'.repeat(stars) || '---'}</div>`;
                if(!locked) div.onclick = () => startLevel(i);
                container.appendChild(div);
            }
            showScreen('screen-map');
        }

        function startLevel(n) {
            state.current = n;
            state.qIdx = 0; state.score = 0; state.log = [];
            
            let cfg = (n <= 10) ? {q:3, o:3} : (n <= 20) ? {q:8, o:4} : {q:10, o:5};
            state.qArray = [...db].sort(() => 0.5 - Math.random()).slice(0, cfg.q);
            
            showScreen('screen-game');
            document.getElementById('level-label').innerText = "N√≠vel " + n;
            loadQ(cfg.o);
        }

        function loadQ(oCount) {
            clearInterval(timer);
            timeLeft = 30;
            updateTimerUI();

            const q = state.qArray[state.qIdx];
            document.getElementById('country-name').innerText = q.p;

            let opts = [q.c];
            while(opts.length < oCount) {
                let r = db[Math.floor(Math.random() * db.length)].c;
                if(!opts.includes(r)) opts.push(r);
            }
            opts.sort(() => 0.5 - Math.random());

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            opts.forEach(o => {
                const b = document.createElement('div');
                b.className = 'btn-opt';
                b.innerText = o;
                b.onclick = () => check(o, q.c, b);
                container.appendChild(b);
            });

            timer = setInterval(() => {
                timeLeft--;
                updateTimerUI();
                if(timeLeft <= 0) { clearInterval(timer); check(null, q.c, null); }
            }, 1000);
        }

        function updateTimerUI() {
            document.getElementById('timer-text').innerText = timeLeft + "s";
            document.getElementById('timer-fill').style.width = (timeLeft / 30 * 100) + "%";
            document.getElementById('timer-fill').style.background = timeLeft < 10 ? "var(--wrong)" : "var(--correct)";
        }

        function check(sel, cor, btn) {
            clearInterval(timer);
            const btns = document.querySelectorAll('.btn-opt');
            btns.forEach(b => b.style.pointerEvents = 'none');

            const ok = sel === cor;
            if(ok) { btn.classList.add('correct'); sndOk.play(); state.score++; }
            else { 
                if(btn) btn.classList.add('wrong'); 
                sndNo.play();
                btns.forEach(b => { if(b.innerText === cor) b.classList.add('correct'); });
            }

            state.log.push({p: state.qArray[state.qIdx].p, c: cor, ok: ok});

            setTimeout(() => {
                state.qIdx++;
                if(state.qIdx < state.qArray.length) loadQ(btns.length);
                else finish();
            }, 1500);
        }

        function finish() {
            const tot = state.qArray.length;
            const acertos = state.score;
            let stars = 0;

            // L√≥gica de Estrelas: 1 por 1 nos n√≠veis curtos, proporcional nos longos
            if (tot === 3) {
                // Para n√≠veis de 3 perguntas: cada acerto √© 1 estrela
                stars = acertos; 
            } else {
                // Para n√≠veis de 8 ou 10 perguntas
                const pct = (acertos / tot) * 100;
                if (pct === 100) stars = 3;
                else if (pct >= 70) stars = 2; // Ex: 6/8 ou 7/10 acertos
                else if (pct >= 40) stars = 1; // Ex: 4/10 acertos
                else stars = 0;
            }
            
            const prev = state.levels[state.current] || 0;
            if(stars > prev) {
                state.totalStars += (stars - prev);
                state.levels[state.current] = stars;
                save();
            }

            document.getElementById('res-stars').innerText = stars > 0 ? "‚≠ê".repeat(stars) : "‚ùå";
            document.getElementById('res-score').innerText = `Acertaste ${state.score} de ${tot}`;
            document.getElementById('res-review').innerHTML = state.log.map(l => `
                <div style="color:${l.ok?'#10b981':'#ef4444'}; margin-bottom:5px;">
                    ${l.ok?'‚úÖ':'‚ùå'} ${l.p}: <b>${l.c}</b>
                </div>
            `).join('');

            showScreen('screen-result');
        }

        showStart();

        // Impede o bot√£o direito
        document.addEventListener('contextmenu', event => event.preventDefault());

        // Impede atalhos de teclado (F12, Ctrl+Shift+I, Ctrl+U)
        document.onkeydown = function(e) {
            if (e.keyCode == 123 ||
                (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) ||
                (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) {
                return false;
            }
        };
    </script>
</body>
</html>
