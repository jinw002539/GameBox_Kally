<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta name="monetag" content="9e9b6e6bd2d0351ee9abd27124ab6535">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quantum Math: Multiverse</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Space+Grotesk:wght@500;700&display=swap');

        :root {
            --bg: #030305;
            --primary: #00f2ff;
            --secondary: #7000ff;
            --accent: #ff007a;
            --success: #39ff14;
            --error: #ff3131;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: manipulation; user-select: none; }

        body {
            background: var(--bg);
            color: white;
            font-family: 'Outfit', sans-serif;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #111, #000);
        }

        .main-container {
            width: 95vw; max-width: 500px;
            background: var(--glass);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 32px;
            padding: 25px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        /* HUD */
        .hud { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: 700; color: var(--primary); font-size: 0.85rem; }
        
        .home-btn {
            cursor: pointer;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.1);
            width: 35px; height: 35px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 10px;
            transition: 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .home-btn:hover { background: var(--primary); color: black; transform: scale(1.1); }

        .timer-bar { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 25px; overflow: hidden; }
        #timer-fill { width: 100%; height: 100%; background: var(--primary); transition: width 1s linear; }

        .hidden { display: none !important; }
        
        /* MODOS DE JOGO */
        .classic-display { font-size: 3rem; text-align: center; margin: 30px 0; font-family: 'Space Grotesk'; text-shadow: 0 0 20px var(--primary); }
        .classic-input { width: 100%; padding: 20px; background: rgba(0,0,0,0.4); border: 2px solid rgba(255,255,255,0.1); border-radius: 16px; color: white; font-size: 2rem; text-align: center; outline: none; }

        .slot-container { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 30px; min-height: 70px; }
        .slot { width: 50px; height: 60px; border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 1.3rem; font-weight: 700; transition: 0.3s; }
        .slot.filled { border-color: var(--primary); background: rgba(0,242,255,0.1); }
        .slot.correct { border-color: var(--success); color: var(--success); box-shadow: 0 0 15px var(--success); }
        .slot.wrong { border-color: var(--error); color: var(--error); animation: shake 0.4s; }

        .tile-pool { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; padding: 15px; background: rgba(255,255,255,0.02); border-radius: 20px; }
        .tile { padding: 12px 15px; background: #1e1e24; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; }

        /* BOT√ïES E MODAIS */
        .btn { width: 100%; padding: 18px; border-radius: 16px; border: none; font-weight: 700; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; margin-top: 15px; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: 0.4s; }
        .modal.active { opacity: 1; pointer-events: all; }
        .modal-content { background: #0d0d11; padding: 35px; border-radius: 32px; width: 90%; max-width: 400px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }

        .choice-card { background: rgba(255,255,255,0.03); padding: 18px; border-radius: 16px; margin: 10px 0; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; text-align: left; }
        .choice-card:hover { border-color: var(--primary); background: rgba(0, 242, 255, 0.05); }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body>

    <div class="main-container">
        <div id="game-hud" class="hidden">
            <div class="hud">
                <div class="home-btn" onclick="Game.goHome()">üè†</div>
                <div>N√çVEL <span id="ui-lvl">1</span></div>
                <div id="ui-lives" style="color:var(--accent)">‚ù§Ô∏è‚ù§Ô∏è</div>
                <div>SCORE: <span id="ui-score">0</span></div>
            </div>
            <div class="timer-bar"><div id="timer-fill"></div></div>
        </div>

        <div id="screen-start">
            <h1 style="text-align:center; margin-bottom:25px; font-family:'Space Grotesk'; letter-spacing:-1px; background:linear-gradient(to right, var(--primary), var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-size:2.2rem;">QUANTUM MATH</h1>
            <div class="choice-card" onclick="Game.setMode('classic')">
                <h3 style="color:var(--primary)">Modo Cl√°ssico</h3>
                <p style="font-size:0.75rem; opacity:0.6; margin-top:4px">Quiz tradicional. Digita a resposta.</p>
            </div>
            <div class="choice-card" onclick="Game.setMode('entropy')">
                <h3 style="color:var(--accent)">Modo Sequ√™ncia</h3>
                <p style="font-size:0.75rem; opacity:0.6; margin-top:4px">Toca nas pe√ßas na ordem certa.</p>
            </div>
        </div>

        <div id="classic-area" class="hidden">
            <div class="classic-display" id="classic-q">...</div>
            <input type="number" id="classic-input" class="classic-input" placeholder="?">
            <button class="btn btn-main" onclick="Game.checkClassic()">CONFIRMAR</button>
        </div>

        <div id="entropy-area" class="hidden">
            <div class="slot-container" id="slots-box"></div>
            <div class="tile-pool" id="tiles-box"></div>
        </div>
    </div>

    <div class="modal" id="modal-level">
        <div class="modal-content">
            <h2 style="margin-bottom:20px; font-family:'Space Grotesk'">Dificuldade</h2>
            <div class="choice-card" onclick="Game.start(1)"><b>N√≠vel 1</b><br><small>2 Vidas | 0-20 | + e -</small></div>
            <div class="choice-card" onclick="Game.start(2)"><b>N√≠vel 2</b><br><small>4 Vidas | 0-50 | Mix</small></div>
            <div class="choice-card" onclick="Game.start(3)"><b>N√≠vel 3</b><br><small>5 Vidas | 0-50 | Caos</small></div>
        </div>
    </div>

    <div class="modal" id="modal-over">
        <div class="modal-content">
            <h1 style="color:var(--error); margin-bottom:10px">FIM DE JOGO</h1>
            <p id="over-msg" style="margin-bottom:30px; opacity:0.7"></p>
            <button class="btn btn-main" onclick="location.reload()">RECOME√áAR</button>
        </div>
    </div>

    <script>
        const Game = {
            mode: 'classic',
            level: 1,
            lives: 0,
            score: 0,
            questionsDone: 0,
            timeLeft: 20,
            timer: null,
            correctOrder: [],
            userOrder: [],
            currentAns: 0,

            setMode(m) {
                this.mode = m;
                document.getElementById('modal-level').classList.add('active');
            },

            goHome() {
                clearInterval(this.timer);
                document.getElementById('game-hud').classList.add('hidden');
                document.getElementById('classic-area').classList.add('hidden');
                document.getElementById('entropy-area').classList.add('hidden');
                document.getElementById('screen-start').classList.remove('hidden');
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
            },

            start(lvl) {
                this.level = lvl;
                this.lives = lvl === 1 ? 2 : (lvl === 2 ? 4 : 5);
                this.score = 0;
                this.questionsDone = 0;
                
                document.getElementById('modal-level').classList.remove('active');
                document.getElementById('screen-start').classList.add('hidden');
                document.getElementById('game-hud').classList.remove('hidden');
                this.next();
            },

            generate() {
                // AJUSTE: N√≠vel 1 (0-20), N√≠veis 2 e 3 (0-50)
                const min = 0;
                const max = (this.level === 1) ? 20 : 50; 
                const rnd = (m, x) => Math.floor(Math.random() * (x - m + 1)) + m;
                
                let ops = ['+', '-'];
                if(this.level >= 2) ops.push('*');
                
                let eq = [];
                let chanceOfThreeTerms = this.level === 1 ? 0.2 : (this.level === 2 ? 0.5 : 0.9);

                if(Math.random() < chanceOfThreeTerms) {
                    let n1 = rnd(min, max);
                    let op1 = ops[Math.floor(Math.random()*ops.length)];
                    let n2 = (op1 === '*') ? rnd(1, 5) : rnd(min, max);
                    let op2 = ops[Math.floor(Math.random()*ops.length)];
                    let n3 = (op2 === '*') ? rnd(1, 4) : rnd(min, max);

                    let res = eval(`${n1}${op1}${n2}${op2}${n3}`);
                    if(res < 0 || res > 100) return this.generate(); 

                    eq = [n1.toString(), op1, n2.toString(), op2, n3.toString(), '=', res.toString()];
                } else {
                    let n1 = rnd(min, max);
                    let op = ops[Math.floor(Math.random()*ops.length)];
                    let n2 = (op === '*') ? rnd(1, 10) : rnd(min, max);
                    
                    if(op === '-' && n1 < n2) [n1, n2] = [n2, n1];
                    
                    let res = eval(`${n1}${op}${n2}`);
                    eq = [n1.toString(), op, n2.toString(), '=', res.toString()];
                }

                this.correctOrder = eq;
                this.currentAns = parseInt(eq[eq.length-1]);
                return eq;
            },

            next() {
                clearInterval(this.timer);
                this.updateHUD();
                const eq = this.generate();
                
                if(this.mode === 'classic') {
                    document.getElementById('classic-area').classList.remove('hidden');
                    document.getElementById('entropy-area').classList.add('hidden');
                    document.getElementById('classic-q').innerText = eq.slice(0, -1).join(' ').replace(/\*/g, '√ó');
                    document.getElementById('classic-input').value = '';
                    document.getElementById('classic-input').focus();
                } else {
                    document.getElementById('classic-area').classList.add('hidden');
                    document.getElementById('entropy-area').classList.remove('hidden');
                    this.renderSequence(eq);
                }
                this.startTimer();
            },

            renderSequence(eq) {
                const slotsBox = document.getElementById('slots-box');
                const tilesBox = document.getElementById('tiles-box');
                slotsBox.innerHTML = ''; tilesBox.innerHTML = '';
                this.userOrder = [];

                eq.forEach(() => {
                    const s = document.createElement('div');
                    s.className = 'slot';
                    slotsBox.appendChild(s);
                });

                const shuffled = [...eq].sort(() => Math.random() - 0.5);
                shuffled.forEach(val => {
                    const t = document.createElement('div');
                    t.className = 'tile';
                    t.innerText = val.replace(/\*/g, '√ó');
                    t.onclick = () => this.handleTileClick(val, t);
                    tilesBox.appendChild(t);
                });
            },

            handleTileClick(val, tileElement) {
                const slots = document.querySelectorAll('.slot');
                const nextSlotIdx = this.userOrder.length;

                if (nextSlotIdx < slots.length) {
                    this.userOrder.push(val);
                    const slot = slots[nextSlotIdx];
                    slot.innerText = val.replace(/\*/g, '√ó');
                    slot.classList.add('filled');
                    tileElement.style.visibility = 'hidden';

                    if (this.userOrder.length === slots.length) this.checkSequence();
                }
            },

            checkSequence() {
                let isMathCorrect = false;
                try {
                    const str = this.userOrder.join('').replace('=', '==');
                    isMathCorrect = eval(str);
                } catch(e) { isMathCorrect = false; }

                if (isMathCorrect) this.success();
                else this.resetSequence();
            },

            resetSequence() {
                document.querySelectorAll('.slot').forEach(s => {
                    s.classList.add('wrong');
                    setTimeout(() => { s.innerText = ''; s.classList.remove('filled', 'wrong'); }, 500);
                });
                setTimeout(() => {
                    this.userOrder = [];
                    document.querySelectorAll('.tile').forEach(t => t.style.visibility = 'visible');
                }, 500);
            },

            checkClassic() {
                const val = parseInt(document.getElementById('classic-input').value);
                if(val === this.currentAns) this.success();
                else this.wrong();
            },

            success() {
                clearInterval(this.timer);
                this.score += (this.level * 10);
                this.questionsDone++;
                if(this.mode === 'entropy') document.querySelectorAll('.slot').forEach(s => s.classList.add('correct'));
                
                document.body.style.background = "#051";
                setTimeout(() => { document.body.style.background = varColor('--bg'); this.next(); }, 600);
            },

            wrong() {
                this.lives--;
                this.updateHUD();
                document.body.style.background = "#400";
                setTimeout(() => document.body.style.background = varColor('--bg'), 400);
                if(this.lives <= 0) this.gameOver();
                else this.next();
            },

            startTimer() {
                this.timeLeft = 20;
                const fill = document.getElementById('timer-fill');
                fill.style.transition = 'none'; fill.style.width = '100%';
                setTimeout(() => { fill.style.transition = 'width 20s linear'; fill.style.width = '0%'; }, 50);
                this.timer = setInterval(() => { this.timeLeft--; if(this.timeLeft <= 0) this.wrong(); }, 1000);
            },

            updateHUD() {
                document.getElementById('ui-lvl').innerText = this.level;
                document.getElementById('ui-score').innerText = this.score;
                let h = ""; for(let i=0; i<this.lives; i++) h += "‚ù§Ô∏è";
                document.getElementById('ui-lives').innerText = h;
            },

            gameOver() {
                clearInterval(this.timer);
                document.getElementById('modal-over').classList.add('active');
                document.getElementById('over-msg').innerText = `PONTOS: ${this.score}`;
            }
        };

        function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }
        document.getElementById('classic-input').onkeypress = (e) => { if(e.key === 'Enter') Game.checkClassic(); };
        
        // Mantendo suas prote√ß√µes originais
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if (e.keyCode == 123 ||
                (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) ||
                (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) {
                return false;
            }
        };
    </script>
</body>
</html>
