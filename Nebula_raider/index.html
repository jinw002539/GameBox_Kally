<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nebula Raider Pro Elite</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-yellow: #ffea00;
            --bg-dark: #02020a;
            --text-color: #ffffff;
        }

        .theme-bw {
            --neon-blue: #ffffff;
            --neon-pink: #ffffff;
            --neon-yellow: #ffffff;
            --bg-dark: #000000;
            --text-color: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; touch-action: none; }

        body {
            background-color: #000;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 500px;
            background: var(--bg-dark);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        canvas { display: block; width: 100%; height: 100%; }

        .ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }

        #hud {
            padding: 15px; display: flex; justify-content: space-between; align-items: flex-start;
            color: var(--text-color); font-size: 0.75rem; text-shadow: 0 0 8px var(--neon-blue);
            opacity: 0; transition: opacity 0.5s;
        }

        .hud-left { display: flex; flex-direction: column; gap: 4px; }

        .pause-btn {
            pointer-events: auto; background: rgba(255,255,255,0.1); border: 1px solid var(--neon-blue);
            color: white; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-family: sans-serif; font-weight: bold; border-radius: 4px;
        }

        .screen {
            position: absolute; inset: 0;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px);
            pointer-events: auto; text-align: center; padding: 20px;
            color: var(--text-color);
        }

        .screen.active { display: flex; }

        h1 { font-size: 2.2rem; color: var(--neon-blue); margin-bottom: 15px; letter-spacing: 2px; }
        .currency-display { color: var(--neon-yellow); font-size: 1rem; margin-bottom: 20px; }

        .menu-btns { display: flex; flex-direction: column; gap: 10px; width: 85%; }

        button {
            background: rgba(255, 255, 255, 0.05); color: var(--text-color);
            border: 1px solid var(--neon-blue); padding: 12px;
            font-family: 'Orbitron', sans-serif; cursor: pointer; transition: 0.2s;
            text-transform: uppercase; font-size: 0.85rem;
        }

        button:hover { background: var(--neon-blue); color: #000; }

        .scores-list {
            text-align: left; width: 80%; margin-bottom: 20px;
            border: 1px solid #333; padding: 15px; background: rgba(255,255,255,0.05);
        }

        .score-entry { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; }

        .shop-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; width: 100%;
            max-height: 40vh; overflow-y: auto;
        }

        .shop-item {
            border: 1px solid #333; padding: 10px; background: rgba(255,255,255,0.03);
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }

        .shop-item.selected { border-color: var(--neon-pink); }

        .scanlines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 20;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div class="scanlines"></div>

        <div class="ui-overlay">
            <div id="hud">
                <div class="hud-left">
                    <div id="score-val">PONTOS: 0</div>
                    <div id="level-val" style="color: var(--neon-pink)">NÍVEL: 1</div>
                    <div id="hp-val">HP: 100%</div>
                </div>
                <div class="pause-btn" id="pause-trigger">||</div>
            </div>

            <!-- Menu Principal -->
            <div id="start-screen" class="screen active">
                <h1>NEBULA RAIDER</h1>
                <div class="currency-display" id="total-coins">CRÉDITOS: 0</div>
                <div class="menu-btns">
                    <button id="start-btn">INICIAR MISSÃO</button>
                    <button id="shop-btn">HANGAR</button>
                    <button id="leaderboard-btn">RECORDES</button>
                    <button id="theme-btn">MUDAR TEMA</button>
                </div>
            </div>

            <!-- Tela de Pausa -->
            <div id="pause-screen" class="screen">
                <h1>PAUSADO</h1>
                <div class="menu-btns">
                    <button id="resume-btn">CONTINUAR</button>
                    <button id="quit-btn">SAIR PARA O MENU</button>
                </div>
            </div>

            <!-- Recordes -->
            <div id="leaderboard-screen" class="screen">
                <h1>RECORDES</h1>
                <div class="scores-list" id="scores-container"></div>
                <button id="back-leader-btn" style="width: 80%;">VOLTAR</button>
            </div>

            <!-- Loja -->
            <div id="shop-screen" class="screen">
                <h1>HANGAR</h1>
                <div class="currency-display" id="shop-coins">CRÉDITOS: 0</div>
                <div class="shop-grid" id="shop-items-container"></div>
                <button id="back-shop-btn" style="width: 80%;">VOLTAR</button>
            </div>

            <!-- Fim de Jogo -->
            <div id="game-over-screen" class="screen">
                <h1 id="fail-title" style="color: var(--neon-pink)">MISSÃO ENCERRADA</h1>
                <div style="color: white; margin-bottom: 20px;">
                    <p id="final-score">PONTOS: 0</p>
                    <p id="final-level" style="color: var(--neon-pink); margin: 5px 0;">NÍVEL: 1</p>
                    <p id="earned-coins" style="color: var(--neon-yellow)">+0 CRÉDITOS</p>
                </div>
                <div class="menu-btns">
                    <button id="restart-btn">TENTAR NOVAMENTE</button>
                    <button id="menu-btn">MENU PRINCIPAL</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DADOS DO JOGO ---
        const GameData = {
            coins: 0,
            highScores: [],
            ownedSkins: ['#ffffff'],
            selectedSkin: '#ffffff',
            theme: 'neon',
            load() {
                const saved = localStorage.getItem('nebula_v5_final');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    this.coins = parsed.coins || 0;
                    this.highScores = parsed.highScores || [];
                    this.ownedSkins = parsed.ownedSkins || ['#ffffff'];
                    this.selectedSkin = parsed.selectedSkin || '#ffffff';
                    this.theme = parsed.theme || 'neon';
                }
                document.body.className = this.theme === 'bw' ? 'theme-bw' : '';
            },
            save() {
                localStorage.setItem('nebula_v5_final', JSON.stringify({
                    coins: this.coins,
                    highScores: this.highScores,
                    ownedSkins: this.ownedSkins,
                    selectedSkin: this.selectedSkin,
                    theme: this.theme
                }));
            },
            addScore(score) {
                this.highScores.push(score);
                this.highScores.sort((a, b) => b - a);
                this.highScores = this.highScores.slice(0, 5);
                this.save();
            }
        };

        const SKINS = [
            { name: 'Padrão', color: '#ffffff', price: 0 },
            { name: 'Ciano', color: '#00f3ff', price: 500 },
            { name: 'Pink', color: '#ff00ff', price: 1000 },
            { name: 'Gold', color: '#ffea00', price: 2500 },
            { name: 'Roxo', color: '#9900ff', price: 4000 }
        ];

        // --- SISTEMA DE ÁUDIO ---
        const AudioFX = {
            ctx: null,
            init() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            play(f, t, d, v) {
                if(!this.ctx) return;
                const o = this.ctx.createOscillator(), g = this.ctx.createGain();
                o.type = t; o.frequency.setValueAtTime(f, this.ctx.currentTime);
                g.gain.setValueAtTime(v, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + d);
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); o.stop(this.ctx.currentTime + d);
            }
        };

        // --- MOTOR DO JOGO ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, player, isPlaying = false, isPaused = false, animationId;
        let hazards = [], bullets = [], particles = [], currentScore = 0, level = 1, frameCount = 0;

        function resize() {
            width = canvas.width = document.getElementById('game-container').clientWidth;
            height = canvas.height = document.getElementById('game-container').clientHeight;
        }
        window.onresize = resize;
        resize();

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.vx = Math.random()*4-2; this.vy = Math.random()*4-2;
                this.life = 1.0;
            }
            update() { this.x += this.vx; this.y += this.vy; this.life -= 0.05; }
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = GameData.theme === 'bw' ? '#fff' : this.color;
                ctx.fillRect(this.x, this.y, 2, 2);
                ctx.globalAlpha = 1;
            }
        }

        class Bullet {
            constructor(x, y) { this.x = x; this.y = y; this.speed = 15; this.alive = true; }
            update() { this.y -= this.speed; if(this.y < -20) this.alive = false; }
            draw() {
                ctx.fillStyle = GameData.theme === 'bw' ? '#fff' : GameData.selectedSkin;
                ctx.fillRect(this.x-1.5, this.y, 3, 15);
            }
        }

        class Hazard {
            constructor() {
                this.type = Math.random() > 0.35 ? 'SHIP' : 'METEOR';
                this.w = this.type === 'METEOR' ? 45 : 30;
                this.h = this.type === 'METEOR' ? 45 : 30;
                this.x = Math.random()*(width - this.w);
                this.y = -60;
                const baseSpd = this.type === 'METEOR' ? 1.5 : 2.5;
                this.speed = (baseSpd + Math.random()) * (1 + (level * 0.1));
                this.hp = this.type === 'METEOR' ? 4 : 1;
                this.angle = 0;
                this.rotSpeed = Math.random()*0.05;
                this.alive = true;
            }
            update() {
                this.y += this.speed;
                if(this.type === 'METEOR') this.angle += this.rotSpeed;
                if(this.y > height + 60) this.alive = false;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x + this.w/2, this.y + this.h/2);
                if(this.type === 'METEOR') {
                    ctx.rotate(this.angle);
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(-this.w/2, -this.h/2, this.w, this.h);
                    ctx.fillStyle = 'rgba(255,255,255,0.1)';
                    ctx.fillRect(-this.w/2, -this.h/2, this.w, this.h);
                } else {
                    // Inimigos não giram
                    ctx.fillStyle = GameData.theme === 'bw' ? '#fff' : '#ff0055';
                    ctx.beginPath();
                    ctx.moveTo(0, this.h/2); ctx.lineTo(this.w/2, -this.h/2); ctx.lineTo(-this.w/2, -this.h/2);
                    ctx.fill();
                }
                ctx.restore();
            }
        }

        class Player {
            constructor() {
                this.x = width/2; this.y = height - 120; this.tx = width/2;
                this.hp = 100; this.cooldown = 0;
            }
            update() {
                this.x += (this.tx - this.x) * 0.2;
                if(this.cooldown > 0) this.cooldown--;
                if(this.cooldown <= 0) {
                    AudioFX.play(350, 'square', 0.1, 0.02);
                    bullets.push(new Bullet(this.x, this.y - 15));
                    this.cooldown = 11;
                }
            }
            draw() {
                ctx.fillStyle = GameData.theme === 'bw' ? '#fff' : GameData.selectedSkin;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y-25); ctx.lineTo(this.x+20, this.y+15);
                ctx.lineTo(this.x, this.y+5); ctx.lineTo(this.x-20, this.y+15);
                ctx.fill();
            }
        }

        function start() {
            AudioFX.init();
            isPlaying = true; isPaused = false;
            currentScore = 0; level = 1; frameCount = 0;
            hazards = []; bullets = []; particles = [];
            player = new Player();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('hud').style.opacity = 1;
            updateHUD();
            loop();
        }

        function loop() {
            if(!isPlaying || isPaused) return;

            ctx.fillStyle = GameData.theme === 'bw' ? '#000' : '#02020a';
            ctx.fillRect(0, 0, width, height);

            const interval = Math.max(35, 75 - (level * 5));
            if(frameCount % interval === 0) hazards.push(new Hazard());

            player.update(); player.draw();

            bullets.forEach((b, i) => {
                b.update(); b.draw();
                if(!b.alive) bullets.splice(i, 1);
            });

            hazards.forEach((h, i) => {
                h.update(); h.draw();
                // Colisão Balas
                bullets.forEach(b => {
                    if(b.alive && h.alive && Math.hypot(b.x - (h.x+h.w/2), b.y - (h.y+h.h/2)) < h.w/2 + 8) {
                        b.alive = false; h.hp--;
                        if(h.hp <= 0) {
                            h.alive = false;
                            const pts = h.type === 'METEOR' ? 300 : 100;
                            currentScore += pts;
                            GameData.coins += h.type === 'METEOR' ? 6 : 2;
                            AudioFX.play(180, 'sawtooth', 0.15, 0.04);
                            for(let k=0; k<8; k++) particles.push(new Particle(h.x+h.w/2, h.y+h.h/2, '#fff'));

                            const nextLvl = Math.floor(currentScore / 1000) + 1;
                            if(nextLvl > level) {
                                level = nextLvl;
                                AudioFX.play(600, 'sine', 0.5, 0.1);
                            }
                            updateHUD();
                        }
                    }
                });
                // Colisão Jogador
                if(h.alive && Math.hypot(player.x - (h.x+h.w/2), player.y - (h.y+h.h/2)) < h.w/2 + 15) {
                    h.alive = false;
                    player.hp -= h.type === 'METEOR' ? 40 : 25;
                    AudioFX.play(100, 'sine', 0.3, 0.1);
                    if(player.hp <= 0) gameOver();
                    updateHUD();
                }
                if(!h.alive) hazards.splice(i, 1);
            });

            particles.forEach((p, i) => {
                p.update(); p.draw();
                if(p.life <= 0) particles.splice(i, 1);
            });

            frameCount++;
            animationId = requestAnimationFrame(loop);
        }

        function updateHUD() {
            document.getElementById('score-val').innerText = `PONTOS: ${currentScore}`;
            document.getElementById('level-val').innerText = `NÍVEL: ${level}`;
            document.getElementById('hp-val').innerText = `HP: ${Math.max(0, player.hp)}%`;
        }

        function togglePause() {
            if(!isPlaying) return;
            isPaused = !isPaused;
            if(isPaused) {
                document.getElementById('pause-screen').classList.add('active');
            } else {
                document.getElementById('pause-screen').classList.remove('active');
                loop();
            }
        }

        function gameOver() {
            isPlaying = false;
            cancelAnimationFrame(animationId);
            const bonus = Math.floor(currentScore / 50);
            GameData.coins += bonus;
            GameData.addScore(currentScore);
            GameData.save();

            document.getElementById('hud').style.opacity = 0;
            document.getElementById('final-score').innerText = `PONTOS: ${currentScore}`;
            document.getElementById('final-level').innerText = `NÍVEL: ${level}`;
            document.getElementById('earned-coins').innerText = `+${bonus} CRÉDITOS ACUMULADOS`;
            document.getElementById('game-over-screen').classList.add('active');
            refreshUI();
        }

        function refreshUI() {
            document.getElementById('total-coins').innerText = `CRÉDITOS: ${GameData.coins}`;
            document.getElementById('shop-coins').innerText = `CRÉDITOS: ${GameData.coins}`;
            const container = document.getElementById('scores-container');
            container.innerHTML = GameData.highScores.length ? '' : '<p>Sem recordes ainda.</p>';
            GameData.highScores.forEach((s, i) => {
                container.innerHTML += `<div class="score-entry"><span>#${i+1}</span> <span>${s} pts</span></div>`;
            });
        }

        function renderShop() {
            const container = document.getElementById('shop-items-container');
            container.innerHTML = '';
            SKINS.forEach(skin => {
                const owned = GameData.ownedSkins.includes(skin.color);
                const selected = GameData.selectedSkin === skin.color;
                const div = document.createElement('div');
                div.className = `shop-item ${selected ? 'selected' : ''}`;
                div.innerHTML = `
                    <div class="color-preview" style="background:${skin.color}; width:30px; height:30px; border-radius:50%"></div>
                    <div style="font-size:0.6rem;">${skin.name}</div>
                    <button ${selected ? 'disabled' : ''} style="font-size:0.5rem; padding:8px; width:100%">
                        ${selected ? 'EQUIPADO' : owned ? 'USAR' : skin.price + ' $'}
                    </button>
                `;
                div.querySelector('button').onclick = () => {
                    if(owned) GameData.selectedSkin = skin.color;
                    else if(GameData.coins >= skin.price) {
                        GameData.coins -= skin.price;
                        GameData.ownedSkins.push(skin.color);
                        GameData.selectedSkin = skin.color;
                    }
                    GameData.save(); renderShop(); refreshUI();
                };
                container.appendChild(div);
            });
        }

        // --- CONTROLES ---
        const move = (e) => {
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const r = canvas.getBoundingClientRect();
            if(player) player.tx = Math.max(20, Math.min(width-20, x - r.left));
        };
        canvas.addEventListener('mousemove', move);
        canvas.addEventListener('touchmove', e => { e.preventDefault(); move(e); }, {passive:false});

        document.getElementById('pause-trigger').onclick = togglePause;
        document.getElementById('resume-btn').onclick = togglePause;
        document.getElementById('quit-btn').onclick = () => {
            isPlaying = false;
            document.getElementById('pause-screen').classList.remove('active');
            document.getElementById('start-screen').classList.add('active');
            document.getElementById('hud').style.opacity = 0;
        };

        document.getElementById('start-btn').onclick = start;
        document.getElementById('restart-btn').onclick = start;
        document.getElementById('menu-btn').onclick = () => {
            document.getElementById('game-over-screen').classList.remove('active');
            document.getElementById('start-screen').classList.add('active');
        };
        document.getElementById('leaderboard-btn').onclick = () => {
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('leaderboard-screen').classList.add('active');
            refreshUI();
        };
        document.getElementById('back-leader-btn').onclick = () => {
            document.getElementById('leaderboard-screen').classList.remove('active');
            document.getElementById('start-screen').classList.add('active');
        };
        document.getElementById('shop-btn').onclick = () => {
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('shop-screen').classList.add('active');
            renderShop();
        };
        document.getElementById('back-shop-btn').onclick = () => {
            document.getElementById('shop-screen').classList.remove('active');
            document.getElementById('start-screen').classList.add('active');
        };
        document.getElementById('theme-btn').onclick = () => {
            GameData.theme = GameData.theme === 'neon' ? 'bw' : 'neon';
            document.body.className = GameData.theme === 'bw' ? 'theme-bw' : '';
            GameData.save();
        };

        GameData.load();
        refreshUI();

        // Impede o botão direito
        document.addEventListener('contextmenu', event => event.preventDefault());

        // Impede atalhos de teclado (F12, Ctrl+Shift+I, Ctrl+U)
        document.onkeydown = function(e) {
            if (e.keyCode == 123 ||
                (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) ||
                (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) {
                return false;
            }
        };
    </script>
</body>
</html>
